<!DOCTYPE html>
{% load static %}

<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>HashTaig</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{% static 'assets/vendors/mdi/css/materialdesignicons.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/css/vendor.bundle.base.css' %}">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script>
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
  
  <link rel="stylesheet" href="{% static 'assets/vendors/jvectormap/jquery-jvectormap.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/flag-icon-css/css/flag-icon.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.theme.default.min.css' %}">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <!-- End layout styles -->

  <style>
    @font-face {
      font-family: 'adobaonlyR';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2205@1.0/adobaonlyR.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    .main-panel {
      font-family: 'adobaonlyR';
    }
    </style>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <!--nav1 zone-->
    {% include 'main/nav1.html' %}


    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_navbar.html -->
      <!--nav2 zone-->
      {% include 'main/nav2.html' %}
      <!-- partial -->
      <div class="main-panel">


        {% comment %} <div class="content-wrapper">
          <div class="row">
            <div class="col-12 grid-margin">
              <div class="card" style="height: 86vh;">
                <div class="card-body">
                  <h4>글수정</h4>
                    <table class="table">
                      <div class="form-group row" style="padding-top: 3vh;">
                        <form class="save-form">
                          {% csrf_token %}
                        <label class="col-sm-3 col-form-label" style="padding-left: 12%; padding-bottom: 4%; font-size: large;">제목</label>
                        <textarea name='title' class="col-sm-6" style="height: 4.5vh; padding-left: 10px; padding-top: 5px; margin-bottom: 10px;">{{title}}</textarea>
                      </div>
                      <div class="form-group row">
                        <label class="col-sm-3 col-form-label" style="padding-left: 12%; padding-bottom: 4%; font-size: large;">내용</label>
                        <textarea name='content' class="col-sm-6" style="height: 35vh; padding-left: 10px; padding-top: 5px;">{{content}}</textarea>
                      </div>
                    </table>

                    <div style="text-align: center; margin-top: 8vw;">
                      <div style="display:inline-block; padding-bottom: 10%; padding-right: 10px;">
                        <div style="float: left; margin-right: 20px;">
                          <button type="button" class="btn btn-light"
                          style="width: 70px; font-size: 80%; margin-bottom: 5%;"
                          onclick="update();"> 수정 </button>
                        </div>
                        </form>
                        <div style="float: left;">
                          <button class="btn btn-light"
                          style="width: 70px; font-size: 80%; margin-left: 1%; margin-bottom: 5%;"
                          onclick="location.href = '/qna'">취소</button>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div> {% endcomment %}



        <div class="content-wrapper">
          <div class="row ">
            <div class="col-12 grid-margin">
              <div class="card" style="height: 86vh;">
                <div class="card-body">
                  <h4 class="card-title">글수정</h4>
                  <div class="table-responsive" style="height: 70vh;">
                    <div style="margin-top: 5%;">
                      <div style="margin-left: 30%;">
                        <form class="update-form">
                          {% csrf_token %}
                          <h4> 제목 </h4>
                          <textarea name='title' style="width: 25.5vw; height: 4vh;">{{title}}</textarea>
                      </div>
                      <div style="margin-left: 30%; padding-bottom: 3%; padding-top: 1%;">
                        <h4 style="margin-top: 2%;">내용</h4>
                        <textarea name='content' style="width: 25.5vw;; height: 25vh;">{{content}}</textarea>
                      </div>
                    </div>
                    <button type="button" style="margin-left: 2%; position:absolute; bottom:4%; left: 39%;"
                      onclick="update();"> 수정 </button>
                    </form>
                    <button style="margin-left: 2%; position:absolute; bottom:4%; left: 45%;"
                      onclick="location.href = '/qna'">취소</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">AI대구경북 화이팅</span>
            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> made by jimi</a></span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- plugins:js 드롭다운 가능하게 하는 js-->
  <script src="{% static 'assets/vendors/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="{% static 'assets/vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{% static 'assets/vendors/progressbar.js/progressbar.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
  <script src="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.js' %}"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="{% static 'assets/js/off-canvas.js' %}"></script>
  <script src="{% static 'assets/js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'assets/js/misc.js' %}"></script>
  <script src="{% static 'assets/js/settings.js' %}"></script>
  <script src="{% static 'assets/js/todolist.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="{% static 'assets/js/dashboard.js' %}"></script>
  <!-- End custom js for this page -->

  <script>
    function update() {
      var form = document.getElementsByClassName('update-form');
      const myformData = new FormData();
      const csrftoken = getCookie('csrftoken');
  
      const url1 = window.location.href;
      
      myformData.append('title', form[0][1].value);
      myformData.append('content', form[0][2].value);
      //myformData.append('user', form[0][3].value);
      //myformData.append('title', form[0][4].value);
      //myformData.append('content', form[0][5].value);
      //myformData.append('date', form[0][6].value);
      
      $.ajax({
        type: "POST",
        url: "",
        async: true,
        headers: { 'X-CSRFToken': csrftoken },
        enctype: "multipart/form-data",
        data: myformData,
        processData: false,
        contentType: false,

        error: function () {
          alert("fail!");
        },
        success: function (result) {
          if (result.status == 'T') {
            window.location.href = '/qna';
            alert("수정 완료!");
          } else if (result.status == 'F'){
            window.location.href = url1;
            alert("제목/내용을 입력해주세요.");
          } else { //(result.status == 'user_error')
            window.location.href = url1;
            alert("권한이 없습니다.");
          }

        }
      });
    };
  </script>
  
  <script type="text/javascript"> 
    function Logout() {
      sessionStorage.clear();
      alert("로그아웃 되었습니다.");
      location.href = "/member/logout";
    }
  </script>
</body>

</html>