<!DOCTYPE html>
{% load static %}

<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>HashTaig</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{% static 'assets/vendors/mdi/css/materialdesignicons.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/css/vendor.bundle.base.css' %}">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script>
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
  
  <link rel="stylesheet" href="{% static 'assets/vendors/jvectormap/jquery-jvectormap.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/flag-icon-css/css/flag-icon.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendors/owl-carousel-2/owl.theme.default.min.css' %}">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="{% static 'assets/images/favicon.png' %}" />
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <div data-include-path='/main/nav'></div>
    <script src="{% static 'custom/nav_loader.js' %}"></script>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_navbar.html -->

      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">

          <div class="row ">
            <div class="col-12 grid-margin">
              <div class="card" style="height: 86vh;">
                <div class="card-body">
                  <h4 class="card-title">글수정</h4>
                  <div class="table-responsive" style="height: 70vh;">
                    <div style="margin-top: 5%;">
                      <div style="margin-left: 30%;">
                        <form class="update-form">
                          {% csrf_token %}
                          <h4> 제목 </h4>
                          <textarea name='title' style="width: 25.5vw; height: 4vh;">{{title}}</textarea>
                      </div>
                      <div style="margin-left: 30%; padding-bottom: 3%; padding-top: 1%;">
                        <h4 style="margin-top: 2%;">내용</h4>
                        <textarea name='content' style="width: 25.5vw;; height: 25vh;">{{content}}</textarea>
                      </div>
                    </div>
                    <button type="button" style="margin-left: 2%; position:absolute; bottom:4%; left: 39%;"
                      onclick="update();"> 수정 </button>
                    </form>
                    <button style="margin-left: 2%; position:absolute; bottom:4%; left: 45%;"
                      onclick="location.href = 'http://127.0.0.1:8000/qna'">취소</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">AI대구경북 화이팅</span>
            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> made by jimi</a></span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- plugins:js 드롭다운 가능하게 하는 js-->
  <script src="{% static 'assets/vendors/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="{% static 'assets/vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{% static 'assets/vendors/progressbar.js/progressbar.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap.min.js' %}"></script>
  <script src="{% static 'assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
  <script src="{% static 'assets/vendors/owl-carousel-2/owl.carousel.min.js' %}"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="{% static 'assets/js/off-canvas.js' %}"></script>
  <script src="{% static 'assets/js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'assets/js/misc.js' %}"></script>
  <script src="{% static 'assets/js/settings.js' %}"></script>
  <script src="{% static 'assets/js/todolist.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="{% static 'assets/js/dashboard.js' %}"></script>
  <!-- End custom js for this page -->

  <script>
    function update() {
      var form = document.getElementsByClassName('update-form');
      const myformData = new FormData();
      const csrftoken = getCookie('csrftoken');
  
      const url1 = window.location.href;
      
      myformData.append('title', form[0][1].value);
      myformData.append('content', form[0][2].value);
      //myformData.append('user', form[0][3].value);
      //myformData.append('title', form[0][4].value);
      //myformData.append('content', form[0][5].value);
      //myformData.append('date', form[0][6].value);
      
      $.ajax({
        type: "POST",
        url: url1,
        async: true,
        headers: { 'X-CSRFToken': csrftoken },
        enctype: "multipart/form-data",
        data: myformData,
        processData: false,
        contentType: false,

        error: function () {
          alert("fail!");
        },
        success: function (result) {
          if (result.status == 'T') {
            window.location.href = '/qna';
            alert("수정 완료!");
          } else {
            window.location.href = url1;
            alert("제목/내용을 입력해주세요");
          }

        }
      });
    };
  </script>
</body>

</html>